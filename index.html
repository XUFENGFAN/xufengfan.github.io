<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>统计代码</title>
    <link rel="shortcut icon" href="favicon.ico"/>
    <!-- Bootstrap的css文件 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/twitter-bootstrap/3.3.0/css/bootstrap.min.css">
    <!--    引入jqurey-->
    <script src="https://cdn.bootcss.com/jquery/3.4.0/jquery.min.js"></script>
    <!--    Bootstrap的js文件-->
    <script src="https://cdn.bootcss.com/twitter-bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <!--    引入Vue-->
    <script src="https://cdn.bootcss.com/vue/2.6.5/vue.min.js"></script>
    <!--    引入Echart-->
    <script src="https://cdn.bootcss.com/echarts/4.2.1-rc1/echarts-en.common.min.js"></script>

</head>
<body>
<!--logo栏-->
<div>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#" style="padding-top: 10px;height: 60px">
                    <svg data-v-0="" version="1.0" xmlns="http://www.w3.org/2000/svg"
                         width="80px" height="60px" viewBox="0 0 340.000000 250.000000"
                         preserveAspectRatio="xMidYMid meet"
                         color-interpolation-filters="sRGB" class="el-tooltip" style="margin: auto;">
                        <rect data-v-0="" x="0" y="0" width="100%" height="100%" fill="url(#watermark)" fill-opacity="1"
                              class="watermarklayer"></rect>
                        <g transform="translate(0,20)">
                            <rect stroke-width="2" x="0" y="0" width="309.3000183105469" height="170.7432861328125"
                                  fill-opacity="0"></rect> <!----> <!---->
                            <g transform="translate(10,3)">
                                <g class="tp-name" transform="translate(0,0)">
                                    <g>
                                        <path transform="translate(-7.4,82.5)"
                                              d="M35.20-55.20L35.20-59L54.80-59L54.80-82.50L58.50-82.50L58.50-59L88-59L88-55.20L58.50-55.20L58.50 4.80L88.70 4.80L88.70 8.30L54.80 8.30L54.80-55.20L35.20-55.20ZM40.50-68.40L25.10-68.40L25.10 12.40L21.50 12.40L21.50-68.40L7.40-68.40L7.40-72.10L36.80-72.10L36.80-80.10L40.50-80.10L40.50-68.40ZM80.10-64.60L76.60-64.60L76.60-82.10L80.10-82.10L80.10-64.60ZM127.90-52.90L145.20-52.90L145.20-2.30L127.90-2.30L127.90-52.90ZM151.20-74.80L181-74.80L181-44.40L186.80-44.40L186.80 10.40L161.10 10.40L161.10 6.70L183.20 6.70L183.20-40.50L152.30-40.50L152.30-64.10L155.90-64.10L155.90-44.40L177.30-44.40L177.30-71.20L151.20-71.20L151.20-74.80ZM131.20-49.30L131.20-6L141.70-6L141.70-49.30L131.20-49.30ZM148.20-70L122.90-70L122.90 10.50L119.50 10.50L119.50-70L115.10-70L115.10-73.70L148.20-73.70L148.20-70ZM177.60-20.40L149.20-20.40L149.20-24.10L177.60-24.10L177.60-20.40ZM218.80 3.30L254.40 3.30L254.40-5.80L226.60-5.80L226.60-9.20L254.40-9.20L254.40-16.60L229.90-16.60L229.90-41.10L284.10-41.10L284.10-16.60L257.90-16.60L257.90-9.20L286.60-9.20L286.60-5.80L257.90-5.80L257.90 3.30L295.10 3.30L295.10 6.80L218.80 6.80L218.80 3.30ZM230.90-54.90L230.90-76.10L283.20-76.10L283.20-54.90L230.90-54.90ZM234.50-72.70L234.50-58.40L279.50-58.40L279.50-72.70L234.50-72.70ZM280.80-19.80L280.80-37.80L257.90-37.80L257.90-30.40L276.20-30.40L276.20-27.10L257.90-27.10L257.90-19.80L280.80-19.80ZM237.80-27.10L237.80-30.40L254.40-30.40L254.40-37.80L233.40-37.80L233.40-19.80L254.40-19.80L254.40-27.10L237.80-27.10ZM215.70-49.50L296.70-49.50L296.70-46L215.70-46L215.70-49.50ZM274.90-67.60L274.90-64.30L238.60-64.30L238.60-67.60L274.90-67.60Z"></path>
                                    </g> <!----> <!----> <!----> <!----> <!----> <!----> <!---->
                                </g>
                            </g>
                        </g>
                    </svg>
                </a>
            </div>
        </div>
    </nav>
</div>
<!--主体-->
<div class="row" id="content">
    <!--添加文件和历史数据栏-->
    <div class="col-md-3">
        <!--添加文件-->
        <div class="panel panel-primary" style="margin-left: 20px">
            <div class="panel-heading">
                <h3 class="panel-title"><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span>&nbsp&nbsp添加文件
                </h3>
            </div>
            <div class="panel-body">
                <div class="form-group" style="width: 80%;margin-left: 10%">
                    <label for="The_File"><span class="glyphicon glyphicon-duplicate" aria-hidden="true"></span>&nbsp上传代码</label>
                    <input type="file" id="The_File" onchange="readFile(this.files)" multiple="multiple">
                    <p>单文件多选（按住ctrl键进行多选）</p>
                    <p class="help-block">请上传.py的文件</p>
                </div>
            </div>
        </div>
        <!--        历史数据-->
        <div class="panel panel-info" style="margin-left: 20px;">
            <div class="panel-heading">
                <h3 class="panel-title"><span class="glyphicon glyphicon-calendar" aria-hidden="true"></span>&nbsp历史数据
                </h3>
            </div>
            <div class="panel-body">
                <div class="list-group" id="week">
                    <a v-for="(week, index) in weeks" href="#" class="list-group-item" @click="show_data(index)">{{
                        week.title }}<span class="badge badge-success">{{week.total}}</span></a>
                </div>
                <p class="text-info">备注：仅显示一个月内数据</p>
            </div>

        </div>

    </div>
    <!--数据统计图-->
    <div class="col-md-6" style="padding-left: 0">
        <div class="panel panel-success" style="margin-left: 20px;height: 500px;">
            <div class="panel-heading">
                <h3 class="panel-title"><span class="glyphicon glyphicon-stats" aria-hidden="true"></span>&nbsp周数据</h3>
            </div>
            <div class="panel-body">
                <div>
                    <div id="main" style="width: 600px;height:400px;"></div>
                </div>
            </div>
        </div>
    </div>
    <!--个人信息及今日结果-->
    <div class="col-md-3">
        <!--        个人信息-->
        <div class="panel panel-warning" style="width: 80%;margin-left: 10px" id="personal">
            <div class="panel-heading">
                <h3 class="panel-title"><span class="glyphicon glyphicon-user" aria-hidden="true"></span>&nbsp个人信息<span
                        class="label label-success" style="float: right">只为十万行</span></h3>
            </div>
            <div class="panel-body">
                <div style="width: 80%;margin-left: 10%">
                    <div><span class="label label-warning" style="font-size: 14px">{{person.level}}</span></div>
                    <div class="progress" style="margin-top: 8px">
                        <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="60"
                             aria-valuemin="0" aria-valuemax="1000" :style="person.width">
                            <span class="sr-only">45% Complete</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--        今日战绩-->
        <div class="panel panel-info" style="width: 80%;margin-left: 10px">
            <div class="panel-heading">
                <h3 class="panel-title"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>&nbsp今日代码统计
                </h3>
            </div>
            <div class="panel-body" id="result">
                <h5>&nbsp&nbsp总行数：<span class="label label-success" style="font-size: 14px;" id="total_line">{{total_line}}</span>
                </h5>
                <h5>代码行数:&nbsp<span class="label label-warning" style="font-size: 14px;">{{total_code}}</span></h5>
                <p class="text-warning">在此手动更新"data"对应列表数据</p>
                <textarea cols="22" rows="6" :value="data_text" onblur="change_data(this.value)"></textarea>
                <p class="text-info"><span class="label label-danger" style="font-size: 12px;">(注意格式)</span></p>
                <button onclick="delete_all()">清除缓存</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('main'));
    // 控制历史记录
    var week = new Vue({
        el: '#week',
        data: {
            weeks: [
                {title: '第一周', data: [0, 0, 0, 0, 0], total: 0},
                {title: '第二周', data: [0, 0, 0, 0, 0], total: 0},
                {title: '第三周', data: [0, 0, 0, 0, 0], total: 0},
                {title: '第四周', data: [0, 0, 0, 0, 0], total: 0},
                // 默认数据
                // {title: '第一周', data: [288, 200, 132, 335, 302], total: 0},
                // {title: '第二周', data: [259, 256, 162, 341, 312], total: 0},
                // {title: '第三周', data: [236, 150, 112, 140, 136], total: 0},
                // {title: '第四周', data: [0, 0, 0, 0, 0], total: 0},
            ],
        },
        methods: {
            show_data: function (week) {
                // 重新配置图表数据
                var option = {
                    series: [{
                        data: this.weeks[week].data,
                    }]
                };
                // 更新图表数据
                myChart.setOption(option);
            }
        },
        created: function () {
            try {  // 如果本地没有这个键对应数据会有异常
                this.weeks = JSON.parse(localStorage.data);
            } catch (e) {
                console.log("第一次运行，欢迎首次使用本应用");//错误信息
            }
            // 对周数据进行初始化求和
            for (let i = 0; i < this.weeks.length; i++) {
            	this.weeks[i].total=0;
                for (let n = 0; n < this.weeks[i].data.length; n++) {
                    this.weeks[i].total += this.weeks[i].data[n];
                }
            }
            // 初始化图表配置项和数据
            var option = {
                title: {
                    text: this.weeks[0].title
                },
                tooltip: {},
                legend: {
                    data: ['代码量']
                },
                xAxis: {
                    data: ["周一", "周二", "周三", "周四", "周五"]
                },
                yAxis: {},
                series: [{
                    // name: '',
                    type: 'bar',
                    data: this.weeks[0].data,
                    color: new echarts.graphic.LinearGradient(
                        0, 0, 0, 1,
                        [
                            {offset: 0, color: '#feac5e'},
                            {offset: 0.5, color: '#c779d0'},
                            {offset: 1, color: '#4bc0c8'}
                        ]
                    )
                }]
            };
            // 使用刚指定的配置项和数据显示图表
            myChart.setOption(option);
        }
    });
    // 控制个人信息
    var personal = new Vue({
        el: '#personal',
        data: {
            person: {
                level: "Python成神之路",
                code_num: 0,
                total_code: 0,
                width: "",
                today: "",
            }
        },
        methods: {
            update(num) {  // 判断日期，保存记录
                this.person.code_num += num;
                this.person.total_code += num;
                if (this.person.code_num > 1000) {
                    this.person.code_num -= 1000;
                }
                this.person.width = "width: " + this.person.code_num / 10 + "%";
                localStorage.width = this.person.width; 
            }
        },
        created: function () {
            try {
                this.person.width = localStorage.width;
            } catch (e) {
                console.log("第一次运行，欢迎首次使用本应用");//错误信息
            }
        }
    });
    // 控制今日结果
    var code_result = new Vue({
        el: '#result',
        data: {
            total_line: 0,
            total_code: 0,
            data_text: "",
        },
        methods:{
        	save() {  // 判断日期，保存记录
                localStorage.total_line = this.total_line;
                localStorage.total_code = this.total_code; 
            }
        },
        created: function () {
            this.data_text = JSON.stringify(week.weeks);
            try {
                this.total_line = localStorage.total_line;
                this.total_code = localStorage.total_code;
            } catch (e) {
                console.log("第一次运行，欢迎首次使用本应用");//错误信息
            }
        },
    });
    // 读取文件数据并进行相关操作
    function readFile(files) {
        let n = 0;
        let b = 0;
        for (let i = 0; i < files.length; i++) {
            let file = files[i];
            let reader = new FileReader();
            reader.onload = function () {
                let result_text = this.result.toString();
                let code_list = result_text.split("\n");  // 切割字符串为数组
                let line_len = result_text.split("\n").length;  // 文件行数
                personal.update(line_len);

                n = n + line_len;  // 多个文件文件累计行数
                code_result.$data.total_line = n;  // 改变Vue总成绩栏总行数数据
                // 判断是否是注释
                let reg = /^#/;
                let reg2 = /^\/\//;
                let reg3 = /<!--/;  // html注释
                let reg4 = /^"""/;
                let reg5 = /^'''/;
                let reg6 = /^[\u4e00-\u9fa5]/;
                for (let a = 0; a < code_list.length; a++) {
                    if (!code_list[a].trim() | reg.test(code_list[a]) | reg2.test(code_list[a]) | reg3.test(code_list[a]) | reg4.test(code_list[a]) | reg5.test(code_list[a]) | reg6.test(code_list[a])) {
                        b++;  // 多文件注释总行数
                    }
                }
                // -----------------------------------------------------------
                code_result.$data.total_code = n - b;  // 改变Vue总成绩栏纯代码总行数
                code_result.save();
            };
            reader.readAsText(file);
        }
    }
    // 改变数据时调用来更新页面数据及本地数据
    function change_data(value) {
        this.data_text = value;
        localStorage.data = value;
        week.weeks = JSON.parse(this.data_text);
        week.show_data(0);
    }
    function delete_all() {
        localStorage.removeItem("data");
        localStorage.removeItem("width");
        localStorage.removeItem("total_line");
        localStorage.removeItem("datotal_codeta");
    }
    // // 存储
    // localStorage.data = "json_str";
    // // 取回
    // localStorage.data;
    // 删除数据
    // localStorage.removeItem("data");
</script>
</body>
</html>
